# BEC漏洞测试用例

使用truffle框架测试BEC漏洞攻击过程

## 测试步骤

```shell
npm install -g truffle    # 安装truffle
npm install               # 安装所需库
npm run test              # 执行漏洞测试用例
```

### 测试用例执行结果

![测试执行结果](assets/1.png)

## BEC漏洞攻击链接

`BEC-Token漏洞实际攻击链接`: <https://etherscan.io/tx/0xad89ff16fd1ebe3a0a7cf4ed282302c06626c1af33221ebe0d3a470aba4a660f>

## DataByte详解

`Databyte详解链接`: <http://me.tryblockchain.org/Solidity-abi-abstraction.html>

```js
使用参数(0x123, [0x456, 0x789], "1234567890", "Hello, world!")调用函数f(uint,uint32[],bytes10,bytes)，编码拆解如下：

bytes4(sha3("f(uint256,uint32[],bytes10,bytes)"))计算MethodID值。对于固定大小的类型值uint256和bytes10，直接编码值。
而对于动态内容类型值uint32[]和bytes，我们先编码偏移值，偏移值是整个值编码的开始到真正存这个数据的偏移值（这里不计算头四个用于表示函数签名的字节）。
所以依次为：

// 0x0000000000000000000000000000000000000000000000000000000000000123 （第一个参数32字节的0x123。
// 0x0000000000000000000000000000000000000000000000000000000000000080 （第二个参数的由于是动态内容类型，所以这里存储偏移值，4*32 字节，刚好是头部部分的大小）
// 0x3132333435363738393000000000000000000000000000000000000000000000 （第三个参数"1234567890" 在右侧补0到32字节大小）
// 0x00000000000000000000000000000000000000000000000000000000000000e0 （第四个参数的偏移 = 7*32 = 0xE0）

// 0x0000000000000000000000000000000000000000000000000000000000000002 （  第二个参数[0x456, 0x789]整个数组的长度，2）。
// 0x0000000000000000000000000000000000000000000000000000000000000456 （    第二个参数的第1个元素）
// 0x0000000000000000000000000000000000000000000000000000000000000789 （    第二个参数的第2个元素）

// 0x000000000000000000000000000000000000000000000000000000000000000d （  第四个参数的长度len(Hello, world!)=13=0x0d）
// 0x48656c6c6f2c20776f726c642100000000000000000000000000000000000000 （"Hello, world!" 13Bytes,补位到32字节，里面是按ascii编码的，可以查查对应的编码。)

// 最终我们得到了下述的编码，为了清晰在函数签名的四个字节后，加了一个换行。

// 0x8be65246
// 0000000000000000000000000000000000000000000000000000000000000123
// 0000000000000000000000000000000000000000000000000000000000000080
// 3132333435363738393000000000000000000000000000000000000000000000
// 00000000000000000000000000000000000000000000000000000000000000e0
// 0000000000000000000000000000000000000000000000000000000000000002
// 0000000000000000000000000000000000000000000000000000000000000456
// 0000000000000000000000000000000000000000000000000000000000000789
// 000000000000000000000000000000000000000000000000000000000000000d
// 48656c6c6f2c20776f726c642100000000000000000000000000000000000000

```

## 联系作者
weixin: vk88128
